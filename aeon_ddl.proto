syntax = "proto3";

import "aeon_error.proto";
import "aeon_schema.proto";

package aeon;

// DDL API to Aeon - a distributed database based on Tarantool.
service DDLService {
  // Creates a space with the given definition.
  rpc CreateSpace(CreateSpaceRequest) returns (CreateSpaceResponse) {}

  // Drops a space by name.
  rpc DropSpace(DropSpaceRequest) returns (DropSpaceResponse) {}

  // Restart CDC for a space.
  rpc RestartCDC(RestartCDCRequest) returns (RestartCDCResponse) {}
}

// Creates a space with the given definition.

message CreateSpaceRequest {
  // CDC section of a space definition.
  message CDC {
    // Queue topic to push captured data changes to.
    string topic = 1;
    // Queue message TTL, in seconds.
    double ttl = 2;
  }
  // Name of the new space.
  string name = 1;
  // Format of the new space.
  repeated FieldDef format = 2;
  // Sorting key definition (indexed fields).
  repeated KeyPartDef key_def = 3;
  // Storage engine.
  Engine engine = 4;
  // CDC configuration.
  CDC cdc = 5;
}

message CreateSpaceResponse {
  // Error information. Set only on failure.
  Error error = 1;
}

// Drops a space by name.

message DropSpaceRequest {
  // Name of the space to drop.
  string name = 1;
}

message DropSpaceResponse {
  // Error information. Set only on failure.
  Error error = 1;
}

// Restart CDC on a space.

message RestartCDCRequest {
  // Name of the space to restart CDC.
  string space = 1;
}

message RestartCDCResponse {
  // Error information. Set only on failure.
  Error error = 1;
}
